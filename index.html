<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!--<link rel='stylesheet' media="screen" href='https://fonts.googleapis.com/css?family=PT+Sans' type='text/css'>-->
	<!--<link rel="stylesheet" media="screen" href='css/reset.css' type="text/css">-->
	<link rel="stylesheet" media="screen" href="css/bootstrap.min.css" type="text/css" />
	<link rel="stylesheet" media="screen" href="css/bootstrap-theme.min.css" type="text/css" />
	<link rel="stylesheet" media="screen" href="css/main.css" type="text/css" />
	<link rel="stylesheet" media="screen" href="css/jquery.timepicker.css" type="text/css" />
	<link rel="stylesheet" media="screen" href="css/digital.clock.css" type="text/css" />
	<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
	<title>Online Exam Helper - Bond University</title>
</head>

<body>
	<!-- BOOTSTRAP CODE HERE -->
	<!-- Fixed navbar -->
	<nav class="navbar navbar-default navbar-fixed-top">
		<div class="container">
			<div id="site-logo">
				<img src="img/bond-logo.png" />
			</div>
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false"
								aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
				<a class="navbar-brand" href="#">Bond University Online Examination Helper</a>
			</div>
			<div id="navbar" class="collapse navbar-collapse">
				<ul class="nav navbar-nav">
					<li>
						<a id="toggleClock" href="#toggleClock"> <span class="glyphicon glyphicon-time" aria-hidden="true"></span> Toggle Clock</a>
					</li>
				</ul>
			</div>
			<!--/.nav-collapse -->
		</div>
	</nav>
	<!-- Begin page content -->
	<div class="container">
		<div class="row" id="clockDisplay">
			<div class="col-sm-12 col-md-12">
				<div class="row">
					<div class="col-md-4" id="analogClock">
					</div>
					<div class="col-md-8 light" id="digitalClock">
						<div class="display">
							<div class="digits"></div>
							<div class="ampm"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-sm-4 col-md-4" id="exam-info">
				<div class="row">
					<div class="col-md-12">
						<label for='subject-code'>Subject Code</label>
						<input type="text" name='subject-code' id='subject-code' placeholder="enter code">
					</div>
				</div>
				<div class="row" id="exam-times">
					<div class="col-md-6">
						<label for='start-time'><span class="glyphicon glyphicon-time" aria-hidden="true"></span> Perusal Start</label>
						<input type="text" name='start-time' id='start-time' class='time start' placeholder="Time">
					</div>
					<div class="col-md-6">
						<label for='end-time'><span class="glyphicon glyphicon-time" aria-hidden="true"></span> Exam End</label>
						<input disabled type="text" name='end-time' id='end-time' class='time end' placeholder="Time">
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
						<label for='password'>Password</label>
						<input type="text" name='password' id='password' placeholder="No password">
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
						<label>Exam Rules</label>
						<audio src="exam-rules.mp3" controls>
							Your browser does not support the audio element.
						</audio>
					</div>
				</div>
			</div>
			<div class="col-sm-8 col-md 8">
				<div class="row">
					<div class="col-md-2">
						<label for='perusal-time'><span class="glyphicon glyphicon-time" aria-hidden="true"></span> Perusal</label>
						<select name='perusal-time' id='perusal-time'>
								<option value="0" selected>None</option>
								<option value="5">5 Min</option>
								<option value="10">10 Min</option>
								<option value="15">15 Min</option>
								<option value="20">20 Min</option>
								<option value="25">25 Min</option>
								<option value="30">30 Min</option>
						</select>
					</div>
					<div class="col-md-2">
						<label for='exam-duration'><span class="glyphicon glyphicon-time" aria-hidden="true"></span> Duration</label>
						<select name='exam-duration' id='exam-duration'>
								<option value="30"> 30 Min</option>
								<option value="60"> 1 Hour</option>
								<option value="90"> 1.5 Hours</option>
								<option value="120" selected> 2 Hours</option>
								<option value="150"> 2.5 Hours</option>
								<option value="180"> 3 Hours</option>
								<option value="210"> 3.5 Hours</option>
								<option value="240"> 4 Hours</option>
						</select>
					</div>
					<div class="col-md-2">
						<label for='bonus-time'><span class="glyphicon glyphicon-time" aria-hidden="true"></span> Extension</label>
						<select name='bonus-time' id='bonus-time'>
								<option value="0" selected>None</option>
								<option value="5">5 Min</option>
								<option value="10">10 Min</option>
								<option value="15">15 Min</option>
						</select>
					</div>
					<div class="col-md-3">
						<label for='include-perusal'>Includes perusal</label>
						<select name='include-perusal' id='include-perusal'>
								<option value="0" selected>No</option>
								<option value="1">Yes</option>
						</select>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
						<label for='additional-notes'>Additional Notes</label>
						<textarea name='additional-notes' id='additional-notes' rows="5"></textarea>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script language="javascript" type="text/javascript" src="js/jquery-3.1.0.min.js"></script>
	<script language="javascript" type="text/javascript" src="js/jquery.maskedinput.min.js"></script>
	<script language="javascript" type="text/javascript" src="js/jquery.timepicker.min.js"></script>
	<script language="javascript" type="text/javascript" src="js/jquery.thooClock.js"></script>
	<script language="javascript" type="text/javascript" src="js/bootstrap.min.js"></script>
	<script language="javascript" type="text/javascript" src="js/moment.min.js"></script>
	<script language="javascript" type="text/javascript" src="js/digital.clock.js"></script>

	<script language="javascript" type="text/javascript">
		function updateEndTime(attempt) {
			if (typeof(attempt)==='undefined') attempt = 0;
			var incPerusal = parseInt($('#include-perusal').val());
			if (!incPerusal) incPerusal = 0;
			console.clear();

			var perusalTime = parseInt($('#perusal-time').val());
			if (!perusalTime) perusalTime = 0;
			var examDuration = parseInt($('#exam-duration').val());
			if (!examDuration) examDuration = 0;
			var bonusTime = parseInt($('#bonus-time').val());
			if (!bonusTime) bonusTime = 0;
			if (!incPerusal) {
				var extraTime = perusalTime + examDuration + bonusTime;
			} else {
				var extraTime = examDuration + bonusTime;
			}
			if (!extraTime) extraTime = 60; //default to 1 hour


			console.log('perusalTime = ' + perusalTime);
			console.log('examDuration = ' + examDuration);
			console.log('extraTime = ' + extraTime);
			var startTime = $('#exam-times .time.start').val();
			console.log('startTime = ' + startTime);

			var ampm = startTime.slice(startTime.length - 2,startTime.length-1);
			console.log('ampm = ' + ampm);

			if (!startTime || !ampm) {
				var count = attempt;
				if (count <= 3) {
					count++;
					console.clear();
					console.log("Invalid Start Time");
					console.log("trying again..")
					updateEndTime(count);
					return;
				}
				else {
					console.log("Couldn't update End Time")
					return;
				}	
			}

			var examTime = startTime.substring(0,startTime.length - 2);
				examTime = examTime.split(':');
			if (ampm == 'a') {
				if (parseInt(examTime[0]) == 12) {
					examTime[0] = 0;
				}
			} else {
				if(parseInt(examTime[0]) != 12) {
					examTime[0] = parseInt(examTime[0]) + 12;
				}
			}
			console.log('t0 = ' + examTime[0]);

			console.log("examTime[0]: " + examTime[0]);
			console.log("examTime[1]: " + examTime[1]);
			var currentTime = moment({hour:examTime[0], minute:examTime[1]});
			var endTime = currentTime.add(extraTime,'m');
			endTime = endTime.format("LT");
			
			console.log('endTime = ' + endTime);
			console.log("changing end time...");
			$('#exam-times .time.end').val(endTime);

		};

		$(document).ready(function() {
			// input change
			if (!$('#exam-duration').val()) $('#exam-duration').val("60");

			//$('#perusal-time').on('change', function() { 
			$('input').on('change', function() { 
				updateEndTime();
			});

			$('select').on('change',function() {
				updateEndTime();
			});

			//timepicker constructor
			$('#exam-times .time').timepicker({
				'scrollDefault': 'now',
  				'timeFormat':'g:i a',
				'step': 15,
				'showDuration': true,
				'forceRoundTime': false
			});

			// initialize datepair
			var examTimes = document.getElementById('exam-times');

			//initialize filter
			$("#subject-code").mask("aaaa99-999", {
				placeholder: " "
			});

			//setup background removals on inputs
			$('input').on('blur', function() {
				$(this).addClass("bg-off");
				$(this).removeClass("bg-on");
			});
			$('input').on('focus', function() {
				$(this).addClass("bg-on");
				$(this).removeClass("bg-off");
			});


			//clock plugin constructor
			$('#analogClock').thooClock({
				//size: $(document).height() / 2,
				size: 300,
				showNumerals: true,
				dialColor: '#184361',
				dialBackgroundColor: 'transparent',
				minuteHandColor: '#F3A829',
				secondHandColor: 'transparent',
				hourHandColor: '#184361',
				onEverySecond: function() {
					//callback that should be fired every second
				}
			});

			$('a#toggleClock').click(function () {
				$( "#clockDisplay" ).toggle();
				
       			
    });
		});
		</script>
</body>

</html>