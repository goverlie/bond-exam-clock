<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!--<link rel='stylesheet' media="screen" href='https://fonts.googleapis.com/css?family=PT+Sans' type='text/css'>-->
	<!--<link rel="stylesheet" media="screen" href='css/reset.css' type="text/css">-->
	<link rel="stylesheet" media="screen" href="css/bootstrap.min.css" type="text/css" />
	<link rel="stylesheet" media="screen" href="css/bootstrap-theme.min.css" type="text/css" />
	<link rel="stylesheet" media="screen" href="css/main.css" type="text/css" />
	<link rel="stylesheet" media="screen" href="css/jquery.timepicker.css" type="text/css" />
	<link rel="stylesheet" media="screen" href="css/digital.clock.css" type="text/css" />
	<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
	<title>Exam Clock - Bond University</title>

</head>

<body>
	<!-- BOOTSTRAP CODE HERE -->
	<!-- Fixed navbar -->
	<nav class="navbar navbar-default navbar-fixed-top">

		<div class="container">
			<div id="site-logo">
				<img src="img/bond-logo.png" />
			</div>
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false"
					aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
				<a class="navbar-brand" href="#">Exam Clock</a>
			</div>
			<div id="navbar" class="collapse navbar-collapse">
				<ul class="nav navbar-nav">
					<li>
						<a id="toggleClock" href="#toggleClock"> <span class="glyphicon glyphicon-time" aria-hidden="true"></span> Toggle Clock</a>
					</li>
				</ul>
			</div>
			<!--/.nav-collapse -->
		</div>
	</nav>

	<!-- Begin page content -->
	<div class="container">
		<div class="row">
			<div class="col-sm-3 col-md-4" id="exam-info">
				<form action='#'>
					<div class="row">
						<div class="col-md-12">
							<label for='subject-code'>Subject Code</label>
							<input type="text" name='subject-code' id='subject-code' placeholder="enter code"></input>
						</div>
					</div>
					<div class="row">
						<div class="col-md-4">
							<label for='perusal-time'>Perusal</label>
							<select name='perusal-time' id='perusal-time'>
								<option value="0" selected>None</option>
								<option value="5">5 Min</option>
								<option value="10">10 Min</option>
								<option value="15">15 Min</option>
								<option value="20">20 Min</option>
								<option value="25">25 Min</option>
								<option value="30">30 Min</option>
							</select>
						</div>
						<div class="col-md-4">
							<label for='exam-duration'>	Duration</label>
							<select name='exam-duration' id='exam-duration'>
								<option value="30"> 30 Min</option>
								<option value="60"> 1 Hour</option>
								<option value="90"> 1.5 Hours</option>
								<option value="120" selected> 2 Hours</option>
								<option value="150"> 2.5 Hours</option>
								<option value="180"> 3 Hours</option>
								<option value="210"> 3.5 Hours</option>
								<option value="240"> 4 Hours</option>
							</select>
						</div>
						<div class="col-md-4">
							<label for='bonus-time'>Extension</label>
							<select name='bonus-time' id='bonus-time'>
								<option value="0" selected>None</option>
								<option value="5">5 Min</option>
								<option value="10">10 Min</option>
								<option value="15">15 Min</option>
							</select>
						</div>
					</div>
					<div class="row" id="exam-times">
						<div class="col-md-6">
							<label for='start-time'>Perusal Start</label>
							<input type="text" name='start-time' id='start-time' class='time start' placeholder="Time"></input>
						</div>
						<div class="col-md-6">
							<label for='end-time'>Exam End</label>
							<input disabled type="text" name='end-time' id='end-time' class='time end' placeholder="Time"></input>
						</div>
					</div>
					<div class="row">
						<div class="col-md-12">
							<label for='password'>Password</label>
							<input type="text" name='password' id='password' placeholder="No password"></input>
						</div>
					</div>
					<div class="row">
						<div class="col-md-12">
							<label for='additional-notes'>Additional Notes</label>
							<textarea name='additional-notes' id='additional-notes' rows="8"></textarea>
						</div>
					</div>
				</form>
			</div>

			<div class="col-sm-9 col-md-8">
				<div class="row">
					<div class="col-md-12 light" id="digitalClock">
						<div class="display">
							<div class="digits"></div>
							<div class="ampm"></div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12" id="analogClock">
					</div>
				</div>
			</div>
		</div>

	</div>

	<script language="javascript" type="text/javascript" src="js/jquery-3.1.0.min.js"></script>
	<script language="javascript" type="text/javascript" src="js/jquery.maskedinput.min.js"></script>
	<script language="javascript" type="text/javascript" src="js/jquery.timepicker.min.js"></script>
	<script language="javascript" type="text/javascript" src="js/jquery.thooClock.js"></script>
	<script language="javascript" type="text/javascript" src="js/bootstrap.min.js"></script>
	<script language="javascript" type="text/javascript" src="js/moment.min.js"></script>
	<script language="javascript" type="text/javascript" src="js/jquery.digitalClock.js"></script>

	<script language="javascript">
		$(window).resize(function() {
			//window.location.reload()
		});

	function updateEndTime(retry=0) {
		console.clear();

		var perusalTime = parseInt($('#perusal-time').val());
		if (!perusalTime) perusalTime = 0;
		var examDuration = parseInt($('#exam-duration').val());
		if (!examDuration) examDuration = 0;
		var bonusTime = parseInt($('#bonus-time').val());
		if (!bonusTime) bonusTime = 0;
		var extraTime = perusalTime + examDuration + bonusTime;
		if (!extraTime) extraTime = 60; //default to 1 hour

		console.log('perusalTime = ' + perusalTime);
		console.log('examDuration = ' + examDuration);
		console.log('extraTime = ' + extraTime);
		var startTime = $('#exam-times .time.start').val();
		console.log('startTime = ' + startTime);

		var ampm = startTime.slice(startTime.length - 2,startTime.length-1);
		console.log('ampm = ' + ampm);

		if (!startTime || !ampm) {
			var count = retry;
			if (count <= 3) {
				count++;
				console.clear();
				console.log("Invalid Start Time");
				console.log("trying again..")
				updateEndTime(count);
				return;
			}
			else {
				console.log("Couldn't update End Time")
				return;
			}
			
		}

		var examTime = startTime.substring(0,startTime.length - 2);
			examTime = examTime.split(':');
		if (ampm == 'a') {
			if (parseInt(examTime[0]) == 12) {
				examTime[0] = 0;
			}
		} else {
			if(parseInt(examTime[0]) != 12) {
				examTime[0] = parseInt(examTime[0]) + 12;
			}
		}
		console.log('t0 = ' + examTime[0]);

		console.log("examTime[0]: " + examTime[0]);
		console.log("examTime[1]: " + examTime[1]);
		var currentTime = moment({hour:examTime[0], minute:examTime[1]});
		var endTime = currentTime.add(extraTime,'m');
		endTime = endTime.format("LT");
		
		console.log('endTime = ' + endTime);
		console.log("changing end time...");
		$('#exam-times .time.end').val(endTime);

}
		$(document).ready(function() {
			// input change
			if (!$('#exam-duration').val()) $('#exam-duration').val("60");

			//$('#perusal-time').on('change', function() { 
			$('input').on('change', function() { 
				updateEndTime();
			});

			$('select').on('change',function() {
				updateEndTime();
			});

			//timepicker constructor
			$('#exam-times .time').timepicker({
				'scrollDefault': 'now',
  				'timeFormat':'g:i a',
				'step': 15,
				'showDuration': true,
				'forceRoundTime': false
			});

			
			// initialize datepair
			var examTimes = document.getElementById('exam-times');

			//initialize filter
			$("#subject-code").mask("aaaa99-999", {
				placeholder: " "
			});

			//setup background removals on inputs
			$('input').on('blur', function() {
				$(this).addClass("bg-off");
				$(this).removeClass("bg-on");
			});
			$('input').on('focus', function() {
				$(this).addClass("bg-on");
				$(this).removeClass("bg-off");
			});


			//clock plugin constructor
			$('#analogClock').toggle().thooClock({
				size: $(document).height() / 1.45,
				showNumerals: true,
				dialColor: '#184361',
				dialBackgroundColor: 'transparent',
				minuteHandColor: '#184361',
				hourHandColor: '#184361',
				onEverySecond: function() {
					//callback that should be fired every second
				}
			});
			//digital clock
			$(function ($) {

				// Cache some selectors

				var clock = $('#digitalClock'),
					alarm = clock.find('.alarm'),
					ampm = clock.find('.ampm');

				// Map digits to their names (this will be an array)
				var digit_to_name = 'zero one two three four five six seven eight nine'.split(' ');

				// This object will hold the digit elements
				var digits = {};

				// Positions for the hours, minutes, and seconds
				var positions = [
					'h1', 'h2', ':', 'm1', 'm2', ':', 's1', 's2'];

				// Generate the digits with the needed markup,
				// and add them to the clock

				var digit_holder = clock.find('.digits');

				$.each(positions, function () {

					if (this == ':') {
						digit_holder.append('<div class="dots">');
					} else {

						var pos = $('<div>');

						for (var i = 1; i < 8; i++) {
							pos.append('<span class="d' + i + '">');
						}

						// Set the digits as key:value pairs in the digits object
						digits[this] = pos;

						// Add the digit elements to the page
						digit_holder.append(pos);
					}

				});

				// Add the weekday names
				var weekday_names = 'Mo Tu We Th Fr Sa Su'.split(' '),
					weekday_holder = clock.find('.weekdays');

				$.each(weekday_names, function () {
					weekday_holder.append('<span>' + this + '</span>');
				});

				var weekdays = clock.find('.weekdays span');


				// Run a timer every second and update the clock
				(function update_time() {
					// Use moment.js to output the current time as a string
					// hh is for the hours in 12-hour format,
					// mm - minutes, ss-seconds (all with leading zeroes),
					// d is for day of week and A is for AM/PM

					var now = moment().format("hhmmssdA");

					digits.h1.attr('class', digit_to_name[now[0]]);
					digits.h2.attr('class', digit_to_name[now[1]]);
					digits.m1.attr('class', digit_to_name[now[2]]);
					digits.m2.attr('class', digit_to_name[now[3]]);
					digits.s1.attr('class', digit_to_name[now[4]]);
					digits.s2.attr('class', digit_to_name[now[5]]);

					// The library returns Sunday as the first day of the week.
					// Stupid, I know. Lets shift all the days one position down, 
					// and make Sunday last

					var dow = now[6];
					dow--;

					// Sunday!
					if (dow < 0) {
						// Make it last
						dow = 6;
					}

					// Mark the active day of the week
					weekdays.removeClass('active').eq(dow).addClass('active');

					// Set the am/pm text:
					ampm.text(now[7] + now[8]);

					// Schedule this function to be run again in 1 sec
					var synced_delay= 1000 - ((new Date().getTime()) % 1000);
					setTimeout(function(){update_time();},synced_delay);
				})();
			}); // End of Digital Clock

			$('a#toggleClock').click(function () {
				var isVisible = $( "#digitalClock" ).is( ":visible" );

				if (isVisible) {
					console.log("switching to analog");
					$('#digitalClock').toggle();
					$('#analogClock').fadeToggle();
				} else {
					console.log("switching to digital");
					$('#digitalClock').fadeToggle();
					$('#analogClock').toggle();
				}
       			
    });
		});
	</script>
</body>

</html>